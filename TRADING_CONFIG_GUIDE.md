# Руководство по настройке торговли

## Обзор

Система теперь поддерживает:
1. **Выбор стратегий и пар** для торговли
2. **Автоматический выбор лучшей стратегии** на основе анализа рынка
3. **Риск-менеджмент на основе процентов** от баланса

## Доступ к настройкам

Откройте страницу конфигурации: `http://localhost:8080/config`

## Выбор стратегий

### Как это работает

1. На странице конфигурации выберите стратегии, которые хотите использовать
2. Если ничего не выбрано, будут использоваться все доступные стратегии
3. Бот автоматически выберет лучшую стратегию из выбранного списка для каждой сделки

### Доступные стратегии

- **RSI Scalping** - торговля на основе индикатора RSI
- **Bollinger Bounce** - торговля на отскоках от полос Боллинджера
- **EMA Crossover** - торговля на пересечениях экспоненциальных скользящих средних
- **Momentum Breakout** - торговля на пробоях с высоким объемом
- **Support/Resistance** - торговля на уровнях поддержки и сопротивления
- **Volume Spike** - торговля на всплесках объема
- **Mean Reversion** - торговля на возврате к среднему

## Выбор торговых пар

### Как это работает

1. Введите символы торговых пар через запятую (например: `BTCUSDT,ETHUSDT,ADAUSDT`)
2. Если поле пустое, бот будет торговать всеми доступными парами
3. Бот будет фильтровать пары по выбранному списку

### Примеры

```
BTCUSDT,ETHUSDT,ADAUSDT
```

или оставьте пустым для торговли всеми парами.

## Автоматический выбор стратегии

### Включение/выключение

- **Включено (по умолчанию)**: Бот автоматически оценивает все выбранные стратегии и выбирает лучшую для каждой сделки
- **Выключено**: Бот использует первую стратегию из списка, которая дает сигнал на вход

### Оценка стратегий

Бот оценивает стратегии по следующим факторам:

1. **Сила сигнала (40%)** - насколько сильный сигнал дает стратегия
2. **Выравнивание технических индикаторов (30%)** - соответствие индикаторов условиям стратегии
3. **Объем и ликвидность (20%)** - достаточность объема для торговли
4. **Приоритет стратегии (10%)** - приоритет стратегии в системе

### Минимальный балл стратегии

- Настройка: **Минимальный балл стратегии (0.0 - 1.0)**
- По умолчанию: **0.5**
- Только стратегии с баллом выше этого порога будут использоваться

## Риск-менеджмент (процентная система)

Все настройки риск-менеджмента теперь работают как проценты от баланса.

### Параметры

1. **Размер позиции (% от баланса на сделку)**
   - По умолчанию: **5%**
   - Рекомендуется: **1-10%**
   - Определяет, какой процент баланса использовать для каждой сделки

2. **Стоп-лосс (%)**
   - По умолчанию: **0.5%**
   - Рекомендуется: **0.5-2%**
   - Процент убытка, при котором позиция будет закрыта

3. **Тейк-профит (%)**
   - По умолчанию: **0.3%**
   - Рекомендуется: **0.3-1%**
   - Процент прибыли, при котором позиция будет закрыта

4. **Максимальный дневной убыток (%)**
   - По умолчанию: **10%**
   - Рекомендуется: **5-15%**
   - При достижении этого процента убытка торговля будет остановлена

### Пример расчета

Если баланс = **10,000 USDT**:
- Размер позиции 5% = **500 USDT** на сделку
- Стоп-лосс 0.5% = **50 USDT** максимальный убыток на сделку
- Тейк-профит 0.3% = **30 USDT** прибыль на сделку
- Максимальный дневной убыток 10% = **1,000 USDT** максимум убытка в день

## Как работает автоматический выбор стратегии

### Процесс выбора

1. Бот получает список доступных торговых пар
2. Фильтрует пары по выбранному списку (если указан)
3. Для каждой пары:
   - Получает исторические данные
   - Оценивает все выбранные стратегии
   - Выбирает стратегию с наивысшим баллом (если балл >= минимального порога)
   - Открывает сделку с выбранной стратегией

### Пример

Допустим, выбраны стратегии:
- RSI Scalping (балл: 0.7)
- Bollinger Bounce (балл: 0.5)
- EMA Crossover (балл: 0.8)

Бот выберет **EMA Crossover**, так как у нее наивысший балл (0.8).

## API для управления конфигурацией

### Получить текущую конфигурацию
```
GET /config/current
```

### Обновить стратегии
```
POST /config/strategies?strategies=RSI Scalping&strategies=Bollinger Bounce
```

### Обновить пары
```
POST /config/pairs?pairs=BTCUSDT&pairs=ETHUSDT
```

### Обновить риск-менеджмент
```
POST /config/risk?positionSizePercent=5.0&stopLossPercent=0.5&takeProfitPercent=0.3&maxDailyLossPercent=10.0
```

### Обновить режим выбора стратегии
```
POST /config/strategy-selection?autoSelectBestStrategy=true&minStrategyScore=0.5
```

## Рекомендации

### Для начинающих

1. Выберите 2-3 простые стратегии (RSI Scalping, Bollinger Bounce)
2. Выберите 3-5 популярных пар (BTCUSDT, ETHUSDT, ADAUSDT)
3. Используйте консервативные настройки риск-менеджмента:
   - Размер позиции: **2-3%**
   - Стоп-лосс: **0.5%**
   - Тейк-профит: **0.3%**
   - Максимальный дневной убыток: **5%**

### Для опытных трейдеров

1. Выберите все стратегии или комбинацию сложных стратегий
2. Торгуйте всеми доступными парами или выберите специфические
3. Настройте агрессивные параметры:
   - Размер позиции: **5-10%**
   - Стоп-лосс: **1-2%**
   - Тейк-профит: **0.5-1%**
   - Максимальный дневной убыток: **10-15%**

## Хранение конфигурации

Конфигурация сохраняется в базе данных H2 и будет доступна после перезапуска приложения.

## Отладка

Если бот не выбирает стратегии:

1. Проверьте, что стратегии выбраны на странице конфигурации
2. Проверьте минимальный балл стратегии (может быть слишком высоким)
3. Проверьте логи на наличие ошибок оценки стратегий
4. Убедитесь, что выбранные пары доступны на бирже

## Изменения в коде

### Новые компоненты

1. **TradingConfig** - модель конфигурации
2. **TradingConfigService** - сервис управления конфигурацией
3. **StrategyEvaluationService** - сервис оценки стратегий
4. **TradingConfigController** - контроллер для управления конфигурацией

### Обновленные компоненты

1. **TradingScheduler** - теперь использует конфигурацию и автоматический выбор стратегий
2. **TradingService** - теперь использует процентную систему риск-менеджмента

